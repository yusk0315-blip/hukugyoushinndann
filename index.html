<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>å‰¯æ¥­ãƒ«ãƒ¼ãƒˆé¸æŠãƒãƒ™ãƒ«</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111827">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root{
      --bg:#0b1220; --card:#111827; --muted:#9ca3af; --text:#e5e7eb;
      --btn:#1f2937; --btn2:#0ea5e9; --danger:#ef4444; --ok:#22c55e;
      --shadow: 0 14px 35px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(14,165,233,.18), transparent 60%),
                  radial-gradient(900px 600px at 80% 30%, rgba(34,197,94,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      padding: 18px 14px 80px;
    }
    .wrap{max-width:720px; margin:0 auto;}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin: 6px 0 14px;
    }
    .brand{
      display:flex; flex-direction:column; gap:2px;
    }
    .brand h1{margin:0; font-size:18px; letter-spacing:.02em}
    .brand p{margin:0; color:var(--muted); font-size:12px}
    .pill{
      padding:8px 10px; border:1px solid rgba(255,255,255,.08);
      border-radius:999px; font-size:12px; color:var(--muted);
      background: rgba(17,24,39,.55);
      backdrop-filter: blur(8px);
      white-space:nowrap;
    }
    .card{
      background: rgba(17,24,39,.82);
      border:1px solid rgba(255,255,255,.07);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 16px;
      backdrop-filter: blur(10px);
    }
    .sceneTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;
    }
    .sceneTitle .tag{
      font-size:12px; color:var(--muted);
      border:1px solid rgba(255,255,255,.08);
      padding:6px 10px; border-radius:999px;
    }
    .story{
      line-height:1.75;
      font-size:16px;
      margin: 0 0 14px;
      white-space:pre-wrap;
    }
    .choices{display:grid; gap:10px; margin-top:10px}
    button{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(31,41,55,.9);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 14px;
      font-size: 15px;
      text-align:left;
      cursor:pointer;
      transition: transform .06s ease, opacity .2s ease, border-color .2s ease;
    }
    button:active{transform: scale(.99)}
    button:hover{border-color: rgba(14,165,233,.35)}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .mini{
      font-size:12px; padding:10px 12px; border-radius: 12px; opacity:.95
    }
    .primary{ background: rgba(14,165,233,.22); border-color: rgba(14,165,233,.45);}
    .ok{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35);}
    .danger{ background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.35);}
    .muted{ color: var(--muted); font-size:12px; margin-top:10px; line-height:1.6}
    .bar{
      height:10px; background: rgba(255,255,255,.06);
      border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.06);
      margin: 10px 0 0;
    }
    .bar > div{
      height:100%; width:0%;
      background: rgba(14,165,233,.7);
      transition: width .25s ease;
    }
    .resultGrid{display:grid; gap:10px; margin-top:10px}
    .resultBox{
      padding:12px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(31,41,55,.55);
    }
    .resultBox h3{margin:0 0 6px; font-size:14px}
    .resultBox ul{margin:0; padding-left:18px; color:var(--text)}
    a.link{
      color:#7dd3fc; text-decoration:none; border-bottom:1px dashed rgba(125,211,252,.45)
    }
    footer{
      margin-top: 14px; color: var(--muted); font-size: 11px; line-height: 1.6;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>å‰¯æ¥­ãƒ«ãƒ¼ãƒˆé¸æŠãƒãƒ™ãƒ«</h1>
        <p>é¸ã¶ã ã‘ã§ã€Œã‚ãªãŸå‘ãæˆ¦ç•¥ã€ãŒå‡ºã‚‹ï¼ˆã‚¹ãƒãƒ›å®Œçµï¼‰</p>
      </div>
      <div class="pill" id="statusPill">é€²è¡Œ: 0%</div>
    </div>

    <div class="card">
      <div class="sceneTitle">
        <div class="tag" id="sceneTag">START</div>
        <div class="tag" id="stepTag">Step 1</div>
      </div>

      <p class="story" id="storyText"></p>

      <div class="choices" id="choices"></div>

      <div class="bar"><div id="barFill"></div></div>

      <div class="row">
        <button class="mini danger" id="restartBtn">æœ€åˆã‹ã‚‰</button>
        <button class="mini" id="backBtn">ã²ã¨ã¤æˆ»ã‚‹</button>
        <button class="mini primary" id="shareBtn">çµæœã‚’ã‚·ã‚§ã‚¢</button>
        <button class="mini ok" id="copyBtn">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>

      <p class="muted" id="hint">
        ã‚³ãƒ„ï¼šè¨ºæ–­ã‚’Xã«è²¼ã‚‹ã¨åå¿œãŒå–ã‚Šã‚„ã™ã„ã€‚ã€Œçµæœâ†’æ¬¡ã®ä¸€æ‰‹â†’noteãƒªãƒ³ã‚¯ã€ã®é †ãŒå¼·ã„ã€‚
      </p>

      <div id="resultArea" class="resultGrid" style="display:none;"></div>
    </div>

    <footer>
      ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼šé›»æ³¢æ‚ªãã¦ã‚‚å‹•ãPWAã€‚<br>
      ã“ã‚Œã‚’ãã®ã¾ã¾GitHub Pagesã«ç½®ã‘ã°OKã€‚
    </footer>
  </div>

<script>
  // ====== STORY DATAï¼ˆã“ã“ã‚’å¢—ã‚„ã™ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ UPï¼‰ ======
  const NOTE_URL = "https://note.com/yusuke_record/n/n167ac120cec6"; // ã„ã¤ã‚‚ã®å°ç·š
  const STORY = {
    start: {
      tag: "START",
      text:
`ã‚ãªãŸã¯ã€Œæœˆ+5ä¸‡å††ã€ã‚’ç‹™ã†æ™®é€šã®ãƒ‘ãƒ‘ã€‚

ä»Šæ—¥ã€åˆ†å²ã™ã‚‹ã€‚
ã“ã®é¸æŠã§â€œå‘ã„ã¦ã‚‹å‰¯æ¥­ãƒ«ãƒ¼ãƒˆâ€ãŒå‡ºã‚‹ã€‚

ã¾ãšã¯â€¦ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ã¯ï¼Ÿ`,
      choices: [
        { label: "ã‚³ãƒ„ã‚³ãƒ„å‹ï¼ˆæ¯æ—¥å°‘ã—ãªã‚‰ç¶šãï¼‰", next: "steady" },
        { label: "çŸ­æœŸé›†ä¸­å‹ï¼ˆæœŸé™ãŒã‚ã‚‹ã¨ç‡ƒãˆã‚‹ï¼‰", next: "sprint" },
        { label: "è¿·ã„ãŒã¡ï¼ˆæ±ºã‚ã‚‹ä»•çµ„ã¿ãŒæ¬²ã—ã„ï¼‰", next: "indecisive" }
      ]
    },

    steady: {
      tag:"TYPE",
      text:
`ã‚³ãƒ„ã‚³ãƒ„å‹ã€å¼·ã„ã€‚
ã€Œç©ã¿ä¸Šã’ã€ã«å‘ã„ã¦ã‚‹ã€‚

æ¬¡ã€‚ã‚ãªãŸãŒä¸€ç•ªã‚¹ãƒˆãƒ¬ã‚¹æ„Ÿã˜ã‚‹ã®ã¯ï¼Ÿ`,
      choices:[
        { label:"å£²ã‚Œãªã‹ã£ãŸæ™‚ã®ä¸å®‰", next:"risk_low" },
        { label:"ä½œæ¥­ãŒå¢—ãˆã‚‹ã®ãŒå«Œ", next:"time_low" },
        { label:"äººã¨ã®ã‚„ã‚Šå–ã‚ŠãŒé¢å€’", next:"people_low" }
      ]
    },

    sprint: {
      tag:"TYPE",
      text:
`çŸ­æœŸé›†ä¸­å‹ã€çˆ†ç™ºåŠ›ã‚ã‚‹ã€‚
ã€ŒçŸ­æœŸã§æˆæœãŒè¦‹ãˆã‚‹ã€ãƒ«ãƒ¼ãƒˆãŒåˆã†ã€‚

æ¬¡ã€‚åˆæœŸè²»ç”¨ã¯ã©ã†ã™ã‚‹ï¼Ÿ`,
      choices:[
        { label:"ãªã‚‹ã¹ã0å††ã§å§‹ã‚ãŸã„", next:"budget_zero" },
        { label:"1ã€œ3ä¸‡å††ãªã‚‰å‡ºã›ã‚‹", next:"budget_mid" },
        { label:"æŠ•è³‡ã¨ã—ã¦5ä¸‡å††ã¾ã§OK", next:"budget_high" }
      ]
    },

    indecisive: {
      tag:"TYPE",
      text:
`è¿·ã„ãŒã¡ï¼æ‰èƒ½ã€‚
â€œé¸æŠè‚¢ã‚’æ¸›ã‚‰ã™ä»•çµ„ã¿â€ãŒã‚ã‚Œã°ä¼¸ã³ã‚‹ã€‚

æ¬¡ã€‚ã‚ãªãŸãŒä»Šã„ã¡ã°ã‚“æ¬²ã—ã„ã®ã¯ï¼Ÿ`,
      choices:[
        { label:"æ¯æ—¥ã®è¡Œå‹•ãŒæ±ºã¾ã‚‹ã“ã¨", next:"need_system" },
        { label:"ã™ãä½¿ãˆã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬", next:"need_template" },
        { label:"å¤±æ•—ã—ãªã„é“ç­‹", next:"need_map" }
      ]
    },

    // --- steady branches ---
    risk_low: {
      tag:"CHECK",
      text:
`ä¸å®‰ãŒã‚¹ãƒˆãƒ¬ã‚¹ãªã‚‰ã€åœ¨åº«ã‚„ä¾¡æ ¼å¤‰å‹•ãŒå°‘ãªã„æ–¹ãŒã„ã„ã€‚

ã‚ãªãŸã¯æ–‡ç« ã‚’æ›¸ãã®ã¯å¥½ãï¼Ÿ`,
      choices:[
        { label:"ã‚ã‚Šã¨å¥½ãï¼ˆæ›¸ã‘ã‚‹ï¼‰", next:"result_note" },
        { label:"è‹¦æ‰‹ï¼ˆã§ãã‚Œã°é¿ã‘ãŸã„ï¼‰", next:"result_routine" }
      ]
    },
    time_low: {
      tag:"CHECK",
      text:
`ä½œæ¥­ãŒå¢—ãˆã‚‹ã®ãŒå«Œãªã‚‰ã€Œä»•çµ„ã¿åŒ–ã€ä¸€æŠã€‚

ã‚¹ãƒãƒ›ã ã‘ã§å®Œçµã—ãŸã„ï¼Ÿ`,
      choices:[
        { label:"ã‚¹ãƒãƒ›ã ã‘ãŒã„ã„", next:"result_microapp" },
        { label:"PCã‚‚ä½¿ãˆã‚‹ï¼ˆå°‘ã—ãªã‚‰ï¼‰", next:"result_automation" }
      ]
    },
    people_low: {
      tag:"CHECK",
      text:
`äººã¨ã®ã‚„ã‚Šå–ã‚ŠãŒé¢å€’ãªã‚‰ã€ŒåŒ¿åãƒ»éå¯¾é¢ã€ãŒå‹ã¡ã€‚

ã‚ãªãŸã¯â€œä½œã‚‹â€ã®ãŒå¥½ãï¼Ÿ`,
      choices:[
        { label:"å¥½ãï¼ˆä½œã£ã¦æ”¹å–„ã—ãŸã„ï¼‰", next:"result_microapp" },
        { label:"å¥½ãã˜ã‚ƒãªã„ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãŒã„ã„ï¼‰", next:"result_note" }
      ]
    },

    // --- sprint branches ---
    budget_zero: {
      tag:"BUDGET",
      text:
`0å††ãªã‚‰ã€Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„â†’å°ç·šâ†’è²©å£²ã€ãŒæœ€é€Ÿã€‚

é¡”å‡ºã—ã¯ï¼Ÿ`,
      choices:[
        { label:"ãªã—ã§OK", next:"result_note" },
        { label:"ã©ã£ã¡ã§ã‚‚", next:"result_note" }
      ]
    },
    budget_mid: {
      tag:"BUDGET",
      text:
`1ã€œ3ä¸‡ä½¿ãˆã‚‹ãªã‚‰ã€å›è»¢ã®é€Ÿã„â€œè–„åˆ©å¤šå£²â€ã‚‚ã‚ã‚Šã€‚

ç‰©è²©ã«æŠµæŠ—ã‚ã‚‹ï¼Ÿ`,
      choices:[
        { label:"ã‚ã‚‹ï¼ˆé¿ã‘ãŸã„ï¼‰", next:"result_microapp" },
        { label:"ãªã„ï¼ˆã‚„ã£ã¦ã¿ãŸã„ï¼‰", next:"result_resell" }
      ]
    },
    budget_high: {
      tag:"BUDGET",
      text:
`5ä¸‡ã¾ã§OKãªã‚‰ã€ä»•å…¥ã‚Œã®å¹…ãŒåºƒãŒã‚‹ã€‚

ãŸã ã—å¤§äº‹ãªã®ã¯â€œæåˆ‡ã‚Šãƒ«ãƒ¼ãƒ«â€ã€‚
ãƒ«ãƒ¼ãƒ«å®ˆã‚Œã‚‹ï¼Ÿ`,
      choices:[
        { label:"å®ˆã‚Œã‚‹ï¼ˆæ·¡ã€…ã¨ã‚„ã‚‹ï¼‰", next:"result_resell" },
        { label:"è‡ªä¿¡ãªã„ï¼ˆæ„Ÿæƒ…ã§å‹•ãï¼‰", next:"result_system" }
      ]
    },

    // --- indecisive branches ---
    need_system: {
      tag:"NEED",
      text:
`ä»•çµ„ã¿ãŒæ¬²ã—ã„ãªã‚‰ã€ã¾ãšã¯ã€Œæ±ºã‚ã‚‹è£…ç½®ã€ã‹ã‚‰ã€‚

ã‚ãªãŸãŒæ­¢ã¾ã‚Šã‚„ã™ã„ã®ã¯ï¼Ÿ`,
      choices:[
        { label:"ä½•ã‚’ã™ã‚‹ã‹æ±ºã‚ã‚‰ã‚Œãªã„", next:"result_slot" },
        { label:"ã‚„ã‚‹æ°—ãŒç¶šã‹ãªã„", next:"result_habit" }
      ]
    },
    need_template: {
      tag:"NEED",
      text:
`ãƒ†ãƒ³ãƒ—ãƒ¬ãŒæ¬²ã—ã„ãªã‚‰ã€Œå‡ºåŠ›â†’è²¼ã‚‹ã€ã ã‘ã«ã™ã‚‹ã€‚

XæŠ•ç¨¿ã®é »åº¦ã¯ï¼Ÿ`,
      choices:[
        { label:"æ¯æ—¥ï¼ˆæœæ˜¼æ™©ï¼‰", next:"result_xgen" },
        { label:"é€±3ãã‚‰ã„", next:"result_note" }
      ]
    },
    need_map: {
      tag:"NEED",
      text:
`é“ç­‹ãŒæ¬²ã—ã„ãªã‚‰ã€è¿·ã„ã‚’æ¸›ã‚‰ã™â€œä¸€æœ¬é“â€ãŒæ­£ç¾©ã€‚

ã‚ãªãŸã¯ã€Œç¶™ç¶šã€ã‚ˆã‚Šã€Œä¸€ç™ºã€ï¼Ÿ`,
      choices:[
        { label:"ç¶™ç¶šã§å‹ã¡ãŸã„", next:"result_routine" },
        { label:"ä¸€ç™ºã§ä¼¸ã°ã—ãŸã„", next:"result_microapp" }
      ]
    },

    // ====== RESULTS ======
    result_note: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆAï¼šã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‰¯æ¥­ï¼ˆnoteÃ—Xï¼‰",
        summary: "ã‚ãªãŸã¯â€œåœ¨åº«ãªã—ãƒ»ä½ãƒªã‚¹ã‚¯â€ãŒå‘ã„ã¦ã‚‹ã€‚å®Ÿä½“é¨“ï¼‹æ°—ã¥ãã‚’ç©ã¿ä¸Šã’ã‚‹ã‚¿ã‚¤ãƒ—ã€‚",
        nextActions: [
          "noteã®ãƒ†ãƒ¼ãƒã‚’1ã¤ã«å›ºå®šï¼ˆæŠ•è³‡Ã—å®¶åº­Ã—å‰¯æ¥­ï¼‰",
          "æ¯æ—¥Xã§çŸ­æ–‡â†’é€±1ã§noteã«ã¾ã¨ã‚ã‚‹",
          "ç„¡æ–™â†’æœ‰æ–™ã®å°ç·šã‚’1æœ¬ã ã‘ä½œã‚‹"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€ç¨¼ãå‰ã«ã€ç™ºä¿¡ã®å‹ã‚’ä½œã‚Œã€‚å‹ãŒå‹ã¤ã€‚ã€"
      }
    },
    result_microapp: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆBï¼šãƒã‚¤ã‚¯ãƒ­PWAé‡ç”£ï¼ˆç„¡æ–™â†’ä¿¡é ¼â†’è²©å£²ï¼‰",
        summary: "ã‚ãªãŸã¯â€œä½œã£ã¦æ”¹å–„â€ãŒæ­¦å™¨ã€‚å°ã•ã„ä¾¿åˆ©ãƒ„ãƒ¼ãƒ«ã‚’é‡ç”£ã—ã¦ä¿¡ç”¨ã‚’ç©ã‚€ã‚¿ã‚¤ãƒ—ã€‚",
        nextActions: [
          "1æ—¥1ã‚¢ãƒ—ãƒªï¼ˆå°ã•ãï¼‰â†’GitHub Pagesã§å…¬é–‹",
          "Xã§ã€ä½¿ãˆã‚‹URLã€ã¨ã—ã¦æŠ•ç¨¿",
          "æœˆæœ«ã«ã€ã¾ã¨ã‚noteï¼ˆæœ‰æ–™ï¼‰ã€ã«å›å"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€å®Œæˆåº¦ã‚ˆã‚Šå…¬é–‹é€Ÿåº¦ã€‚å…¬é–‹ãŒæœ€å¼·ã®å­¦ç¿’ã€‚ã€"
      }
    },
    result_resell: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆCï¼šå›è»¢å‹ã›ã©ã‚Šï¼ˆå°ã•ãæ¤œè¨¼â†’æ‹¡å¤§ï¼‰",
        summary: "ã‚ãªãŸã¯â€œæ‰‹ã‚’å‹•ã‹ã—ãŸåˆ†ã ã‘çµæœãŒå‡ºã‚‹â€ãƒ«ãƒ¼ãƒˆãŒåˆã†ã€‚æ•°å­—ã§åˆ¤æ–­ã§ãã‚‹ã‚¿ã‚¤ãƒ—ã€‚",
        nextActions: [
          "ä»•å…¥ã‚Œãƒ«ãƒ¼ãƒ«ã‚’å›ºå®šï¼ˆåˆ©ç›Šç‡/å›è»¢æ—¥æ•°/ä¸Šé™ï¼‰",
          "é€±2å›ã ã‘ä»•å…¥ã‚Œâ†’é€±2å›ã ã‘å‡ºå“ï¼ˆä½œæ¥­æ—¥ã‚’æ±ºã‚ã‚‹ï¼‰",
          "åˆ©ç›Šã®åŠåˆ†ã¯æŠ•è³‡ã«è‡ªå‹•ç§»å‹•"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€ä»•å…¥ã‚Œã®æ™‚ç‚¹ã§å‹è² ã¯æ±ºã¾ã£ã¦ã‚‹ã€‚ã€"
      }
    },
    result_automation: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆDï¼šè‡ªå‹•åŒ–Ã—ç™ºä¿¡ï¼ˆä»•çµ„ã¿ã§å‹ã¤ï¼‰",
        summary: "ã‚ãªãŸã¯â€œä½œæ¥­ã‚’æ¸›ã‚‰ã™è¨­è¨ˆâ€ãŒå‘ã„ã¦ã‚‹ã€‚é¢å€’ã‚’å«Œã†ã®ã¯æ‰èƒ½ã€‚",
        nextActions: [
          "æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’3ã¤ä½œã£ã¦å›ºå®š",
          "æ¯æ™©10åˆ†ã§ç¿Œæ—¥ã®æŠ•ç¨¿ã‚’ã¾ã¨ã‚ã¦ä½œã‚‹",
          "1é€±é–“ã§æ”¹å–„ç‚¹ã ã‘è§¦ã‚‹ï¼ˆæ¯æ—¥ã„ã˜ã‚‰ãªã„ï¼‰"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€é ‘å¼µã‚‹ãªã€ä»•çµ„ã¿ã«ã‚„ã‚‰ã›ã‚ã€‚ã€"
      }
    },
    result_routine: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆEï¼šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³å‰¯æ¥­ï¼ˆç¶™ç¶šã§å‹ã¤ï¼‰",
        summary: "ã‚ãªãŸã¯â€œå°‘ã—ãšã¤ä¼¸ã³ã‚‹â€ãƒ«ãƒ¼ãƒˆãŒæœ€å¼·ã€‚ãƒ¡ãƒ³ã‚¿ãƒ«å®‰å®šãŒæ­¦å™¨ã€‚",
        nextActions: [
          "æ¯æ—¥ã‚„ã‚‹ã“ã¨ã‚’1ã¤ã ã‘ã«ã™ã‚‹",
          "çµæœã¯é€±1ã§æŒ¯ã‚Šè¿”ã‚‹ï¼ˆæ¯æ—¥è¦‹ãªã„ï¼‰",
          "è¾ã‚ãªã„ä»•çµ„ã¿ï¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å›ºå®šã™ã‚‹"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€å‹ã¤äººã¯ã€ç¶šã‘ãŸäººã€‚ã€"
      }
    },
    result_system: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆFï¼šãƒ«ãƒ¼ãƒ«å…ˆã«ä½œã‚‹ï¼ˆæ„Ÿæƒ…å¯¾ç­–ï¼‰",
        summary: "ã‚ãªãŸã¯å‹¢ã„ãŒå‡ºã‚‹ã»ã©å±ãªã„ã€‚ã ã‹ã‚‰å…ˆã«â€œãƒ«ãƒ¼ãƒ«â€ãŒå¿…è¦ã€‚",
        nextActions: [
          "è²·ã†æ¡ä»¶/è²·ã‚ãªã„æ¡ä»¶ã‚’ç´™ã«æ›¸ã",
          "ä¸Šé™é‡‘é¡ã‚’æ±ºã‚ã‚‹ï¼ˆçµ¶å¯¾ã«è¶…ãˆãªã„ï¼‰",
          "é€±1ã ã‘æ•°å­—ã‚’è¦‹ã‚‹ï¼ˆæ¯æ—¥ã¯è¦‹ãªã„ï¼‰"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€ãƒ«ãƒ¼ãƒ«ãŒãªã„ï¼é‹ã‚²ãƒ¼ã«ãªã‚‹ã€‚ã€"
      }
    },
    result_slot: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆGï¼šæ±ºã‚ã‚‹è£…ç½®ï¼ˆè¿·ã„æ’ƒé€€ï¼‰",
        summary: "ã‚ãªãŸã¯â€œé¸æŠè‚¢ãŒå¤šã„â€ã»ã©æ­¢ã¾ã‚‹ã€‚ã ã‹ã‚‰æ±ºã‚ã‚‹ä»•çµ„ã¿ãŒå¿…è¦ã€‚",
        nextActions: [
          "ã‚¿ã‚¹ã‚¯å€™è£œã‚’5ã¤ã¾ã§ã«çµã‚‹",
          "ã‚¹ãƒ­ãƒƒãƒˆã§1ã¤ã«æ±ºã‚ã‚‹ï¼ˆæ‚©ã¾ãªã„ï¼‰",
          "çµ‚ã‚ã£ãŸã‚‰ä¸¸ã‚’ä»˜ã‘ã‚‹ã ã‘"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€æ‚©ã‚€æ™‚é–“ï¼å‰¯æ¥­ã®æ•µã€‚ã€"
      }
    },
    result_habit: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆHï¼šç¿’æ…£åŒ–ï¼ˆç¶šã‹ãªã„ã‚’å€’ã™ï¼‰",
        summary: "ã‚ãªãŸã¯â€œæ°—åˆã„â€ã˜ã‚ƒãªãâ€œç’°å¢ƒâ€ã§å‹ã¤ã‚¿ã‚¤ãƒ—ã€‚",
        nextActions: [
          "ã‚„ã‚‹å ´æ‰€/æ™‚é–“ã‚’å›ºå®šã™ã‚‹",
          "1å›ã®é‡ã‚’å°ã•ãã™ã‚‹ï¼ˆ5åˆ†ã§ã‚‚OKï¼‰",
          "é€£ç¶šæ—¥æ•°ã‚’è¦‹ãˆã‚‹åŒ–ã™ã‚‹"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€ã‚„ã‚‹æ°—ã˜ã‚ƒãªã„ã€ä»•çµ„ã¿ã€‚ã€"
      }
    },
    result_xgen: {
      tag:"RESULT",
      result: {
        title: "ãƒ«ãƒ¼ãƒˆIï¼šXæŠ•ç¨¿ã‚¸ã‚§ãƒÃ—noteå°ç·šï¼ˆæœ€çŸ­ï¼‰",
        summary: "ã‚ãªãŸã¯â€œå‡ºåŠ›ã—ã¦è²¼ã‚‹ã ã‘â€ãŒåˆã†ã€‚æŠ•ç¨¿ãŒæ­¢ã¾ã‚‰ãªããªã‚‹ã€‚",
        nextActions: [
          "æœæ˜¼æ™©ã®å‹ã‚’å›ºå®šï¼ˆä½“é¨“â†’å­¦ã³â†’è¡Œå‹•ï¼‰",
          "æ¯å›noteãƒªãƒ³ã‚¯ã‚’æœ€å¾Œã«ä»˜ã‘ã‚‹",
          "åå¿œãŒè‰¯ã„æŠ•ç¨¿ã ã‘noteã§æ·±æ˜ã‚Š"
        ],
        hook: "ä»Šæ—¥ã®ä¸€è¨€ï¼šã€æŠ•ç¨¿ã¯è³‡ç”£ã€‚æºœã‚ã‚‹ã»ã©å¼·ããªã‚‹ã€‚ã€"
      }
    },
  };

  // ====== STATE ======
  const STORAGE_KEY = "route_novel_state_v1";
  const state = loadState() || { current: "start", history: [], done: false, lastResultText: "" };

  const storyText = document.getElementById("storyText");
  const choicesEl = document.getElementById("choices");
  const resultArea = document.getElementById("resultArea");
  const sceneTag = document.getElementById("sceneTag");
  const stepTag = document.getElementById("stepTag");
  const statusPill = document.getElementById("statusPill");
  const barFill = document.getElementById("barFill");

  document.getElementById("restartBtn").addEventListener("click", () => {
    if (!confirm("æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™ï¼Ÿ")) return;
    state.current = "start";
    state.history = [];
    state.done = false;
    state.lastResultText = "";
    saveState();
    render();
  });

  document.getElementById("backBtn").addEventListener("click", () => {
    if (state.history.length === 0) return;
    state.current = state.history.pop();
    state.done = false;
    saveState();
    render();
  });

  document.getElementById("shareBtn").addEventListener("click", async () => {
    const text = makeShareText();
    const url = location.href;
    try{
      if (navigator.share) {
        await navigator.share({ title: "å‰¯æ¥­ãƒ«ãƒ¼ãƒˆè¨ºæ–­", text, url });
      } else {
        await navigator.clipboard.writeText(text + "\n" + url);
        alert("ã‚·ã‚§ã‚¢æ–‡ã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆï¼ˆè²¼ã‚Šä»˜ã‘ã¦ä½¿ã£ã¦ï¼‰");
      }
    }catch(e){}
  });

  document.getElementById("copyBtn").addEventListener("click", async () => {
    const text = makeShareText() + "\n" + location.href;
    try{
      await navigator.clipboard.writeText(text);
      alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆï¼");
    }catch(e){
      alert("ã‚³ãƒ”ãƒ¼ã§ããªã‹ã£ãŸâ€¦ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã®å½±éŸ¿ã‹ã‚‚ï¼‰");
    }
  });

  function render(){
    const node = STORY[state.current];
    if (!node) return;

    sceneTag.textContent = node.tag || "SCENE";
    stepTag.textContent = `Step ${state.history.length + 1}`;

    const progress = calcProgress();
    statusPill.textContent = `é€²è¡Œ: ${progress}%`;
    barFill.style.width = `${progress}%`;

    // clear
    choicesEl.innerHTML = "";
    resultArea.style.display = "none";
    resultArea.innerHTML = "";

    if (node.result){
      state.done = true;
      const r = node.result;

      storyText.textContent =
`${r.title}

${r.summary}

ğŸ‘‡ æ¬¡ã®ä¸€æ‰‹ï¼ˆã“ã®é †ã§OKï¼‰`;
      // show result boxes
      resultArea.style.display = "grid";
      resultArea.appendChild(makeBox("æ¬¡ã®ä¸€æ‰‹", listToHtml(r.nextActions)));
      resultArea.appendChild(makeBox("ä¸€è¨€", `<div style="line-height:1.7">${escapeHtml(r.hook)}</div>`));
      resultArea.appendChild(makeBox("å°ç·š", `<div style="line-height:1.7">
        noteã¯ã“ã¡ã‚‰ â†’ <a class="link" href="${NOTE_URL}" target="_blank" rel="noopener">${escapeHtml(NOTE_URL)}</a>
      </div>`));

      state.lastResultText = makeShareText();
      saveState();
      return;
    }

    storyText.textContent = node.text || "";

    (node.choices || []).forEach(ch => {
      const b = document.createElement("button");
      b.textContent = ch.label;
      b.addEventListener("click", () => {
        state.history.push(state.current);
        state.current = ch.next;
        saveState();
        render();
      });
      choicesEl.appendChild(b);
    });

    saveState();
  }

  function makeBox(title, inner){
    const div = document.createElement("div");
    div.className = "resultBox";
    div.innerHTML = `<h3>${escapeHtml(title)}</h3>${inner}`;
    return div;
  }

  function listToHtml(arr){
    const items = arr.map(s => `<li>${escapeHtml(s)}</li>`).join("");
    return `<ul>${items}</ul>`;
  }

  function calcProgress(){
    // è¶…ã–ã£ãã‚Šï¼š3ã€œ4æ‰‹ã§çµæœã«åˆ°é”ã™ã‚‹æƒ³å®š
    const steps = Math.min(4, state.history.length + 1);
    const p = Math.round((steps / 4) * 100);
    return Math.max(5, Math.min(100, p));
  }

  function makeShareText(){
    if (!state.done){
      return "å‰¯æ¥­ãƒ«ãƒ¼ãƒˆè¨ºæ–­ã‚„ã£ã¦ã‚‹ã€‚ã‚ãªãŸã¯ã©ã‚Œï¼Ÿ";
    }
    // result node
    const node = STORY[state.current];
    const title = node?.result?.title || "è¨ºæ–­çµæœ";
    const hook = node?.result?.hook || "";
    return `ã€å‰¯æ¥­ãƒ«ãƒ¼ãƒˆè¨ºæ–­ã€‘\n${title}\n${hook}\n#å‰¯æ¥­ #æŠ•è³‡ #note`;
  }

  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }
  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : null;
    }catch(e){
      return null;
    }
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  // Register SW
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js").catch(()=>{}));
  }

  render();
</script>
</body>
</html>
